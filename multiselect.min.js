function Multiselect(e){if("undefined"!=typeof $&&!$(e).is("select"))throw"Multiselect: passed object must be a select";if("undefined"==typeof $&&"SELECT"!=e.tagName)throw"Multiselect: passed object must be a select";"undefined"!=typeof $?this._item=e[0]:this._item=e,this._createUI(),this._appendEvents(),this._initSelectedFields()}function hideMultiselects(e){for(var t=0;t<window.multiselects.length;t++){var i=window.multiselects[t];if(document.getElementById(i._getItemListIdentifier()).offsetParent){for(var n=e.target.parentElement;n&&"BODY"!=n.tagName;){if(n.id==i._getIdentifier())return;n=n.parentElement}i._hideList(i,e)}}}Multiselect.prototype={_createUI:function(){var e=document.getElementById(this._getIdentifier());e&&e.parentNode.removeChild(e);var t=this._createWrapper(),i=this._item.parentNode;this._item.nextElementSibling?i.insertBefore(t,this._item.nextElementSibling):i.appendChild(t),t.appendChild(this._createInputField()),t.appendChild(this._createItemList()),this._item.style.display="none"},_createWrapper:function(){var e=document.createElement("div");return e.className="multiselect-wrapper",e.id=this._getIdentifier(),e},_createInputField:function(){var e=document.createElement("input");e.className="multiselect-input",e.setAttribute("type","text"),e.id=this._getInputFieldIdentifier();var t=document.createElement("label");t.className="multiselect-count",t.setAttribute("for",this._getInputFieldIdentifier()),t.id=this._getInputBadgeIdentifier(),t.style.visibility="hidden",t.innerHTML=0;var i=document.createElement("label");i.setAttribute("for",this._getInputFieldIdentifier()),i.className="multiselect-dropdown-arrow";var n=document.createElement("div");return n.className="multiselect-input-div",n.appendChild(e),n.appendChild(t),n.appendChild(i),n},_createItemList:function(){for(var e=this._getItems(this._item),t=document.createElement("ul"),i=0;i<e.length;i++){var n=this._createItem("li",e[i].id,e[i].text,e[i].selected);t.appendChild(n);var l=n.querySelector("input[type=checkbox]");e[i].multiselectElement=l,l.dataset.multiselectElement=JSON.stringify(e[i])}var r=this._createItem("span",-1,"Select all"),s=document.createElement("div");return s.id=this._getItemListIdentifier(),s.className="multiselect-list",s.appendChild(r),s.appendChild(document.createElement("hr")),s.appendChild(t),s},_createItem:function(e,t,i,n){var l=document.createElement("input");l.className="multiselect-checkbox",l.setAttribute("type","checkbox"),l.dataset.val=t;var r=document.createElement("span");r.className="multiselect-text",r.innerHTML=i;var s=document.createElement(e),d=document.createElement("label");return d.appendChild(l),d.appendChild(r),s.appendChild(d),s},_initSelectedFields:function(){var e=this._getItems(),t=e.filter(function(e){return e.selected});if(0!=t.length)for(var i=0;i<t.length;i++)this.select(t[i].id);else this.selectAll()},select:function(e){var t=this;if(e)for(var i=document.getElementById(this._getIdentifier()).querySelectorAll(".multiselect-checkbox"),n=0;n<i.length;n++){var l=i[n].dataset;l.val==e&&t._onCheckBoxChange(i[n],t)}},selectAll:function(e){var t=document.querySelector("#"+this._getIdentifier()+" .multiselect-checkbox");t.checked=!0,this._onCheckBoxChange(t,this),this._hideList(this)},_appendEvents:function(){var e=this;document.getElementById(e._getInputFieldIdentifier()).addEventListener("focus",function(t){e._showList(e),document.getElementById(e._getInputFieldIdentifier()).value="";for(var i=0;i<window.multiselects.length;i++){var n=window.multiselects[i];if(document.getElementById(n._getItemListIdentifier()).offsetParent){for(var l=t.target.parentElement;l&&"BODY"!=l.tagName;){if(l.id==n._getIdentifier())return;l=l.parentElement}n._hideList(n)}}}),document.getElementById(e._getInputFieldIdentifier()).addEventListener("click",function(){e._showList(e),document.getElementById(e._getInputFieldIdentifier()).value=""}),document.getElementById(e._getIdentifier()).addEventListener("click",function(t){t=t||window.event;for(var i=(t.target||t.srcElement,t.target.parentElement);i&&"BODY"!=i.tagName;){if(i.id==e._getIdentifier())return;i=i.parentElement}t.stopPropagation()}),document.getElementById(e._getItemListIdentifier()).addEventListener("mouseover",function(){e._showList(e)});for(var t=document.querySelectorAll("#"+e._getIdentifier()+" .multiselect-checkbox"),i=0;i<t.length;i++)t[i].addEventListener("change",function(t){e._onCheckBoxChange(this,e,t)});var n=function(){var t=this.value.toLowerCase();if(t&&""!=t){document.querySelector("#"+e._getItemListIdentifier()+" > span").style.display="none",document.querySelector("#"+e._getItemListIdentifier()+" > hr").style.display="none";var i=document.querySelectorAll("#"+e._getItemListIdentifier()+" li span");i=Array.prototype.filter.call(i,function(e){return e.innerHTML.toLowerCase().indexOf(t)>-1});for(var n=document.querySelectorAll("#"+e._getItemListIdentifier()+" li"),l=0;l<n.length;l++){var r=n[l];r.style.display="none"}for(var l=0;l<i.length;l++){var r=i[l];r.parentElement.parentElement.style.display="block"}}else{document.querySelector("#"+e._getItemListIdentifier()+" > span").style.display="block",document.querySelector("#"+e._getItemListIdentifier()+" > hr").style.display="block";for(var s=document.querySelectorAll("#"+e._getItemListIdentifier()+" li"),l=0;l<s.length;l++)s[l].style.display="block"}};document.getElementById(e._getInputFieldIdentifier()).addEventListener("propertychange",n),document.getElementById(e._getInputFieldIdentifier()).addEventListener("input",n)},_onCheckBoxChange:function(e,t,i){var n=e.dataset,l=e.checked;if(n.multiselectElement){var r=JSON.parse(e.dataset.multiselectElement);l?(t._itemCounter++,this._item.options[r.index].setAttribute("selected","selected"),e.parentElement.parentElement.classList.add("active")):(t._itemCounter--,this._item.options[r.index].removeAttribute("selected"),e.parentElement.parentElement.classList.remove("active"));var s=document.getElementById(t._getItemListIdentifier()).querySelector("input[type=checkbox]");t._itemCounter==t._getItems().length?s.checked=!0:s.checked&&(s.checked=!1)}else{var d=t._getItems();if(l){t._itemCounter=d.length;for(var c=0;c<d.length;c++)d[c].multiselectElement.parentElement.parentElement.classList.add("active"),this._item.options[d[c].index].setAttribute("selected","selected"),d[c].multiselectElement.checked=!0}else{t._itemCounter=0;for(var c=0;c<d.length;c++)d[c].multiselectElement.parentElement.parentElement.classList.remove("active"),this._item.options[d[c].index].removeAttribute("selected"),d[c].multiselectElement.checked=!1}}t._forceUpdate()},_hideList:function(e,t){document.getElementById(e._getItemListIdentifier()).classList.remove("active"),document.getElementById(e._getItemListIdentifier()).querySelector("span").style.display="block",document.getElementById(e._getItemListIdentifier()).querySelector("hr").style.display="block";var i=document.getElementById(e._getItemListIdentifier()).querySelectorAll("li");if(0!=i.length)for(var n=0;n<i.length;n++)i[n].style.display="block";var l=document.getElementById(e._getItemListIdentifier()).querySelectorAll("ul .active");if(l.length>0){for(var r="",n=0;n<(l.length<5?l.length:5);n++)r+=l[n].innerText+", ";r=r.substr(0,r.length-2),r.length>20&&(r=r.substr(0,17)+"..."),l.length==document.getElementById(e._getItemListIdentifier()).querySelectorAll("ul li").length&&(r="All selected"),document.getElementById(e._getInputFieldIdentifier()).value=r}t&&t.stopPropagation()},_showList:function(e){document.getElementById(e._getItemListIdentifier()).classList.add("active")},_forceUpdate:function(){var e=document.getElementById(this._getInputBadgeIdentifier());if(e.style.visibility="hidden",0!=this._itemCounter){e.innerHTML=this._itemCounter,e.style.visibility="visible";var t=e.nextElementSibling;this._itemCounter<10?(e.style.left="-45px",t.style.marginLeft="-42px"):this._itemCounter<100?(e.style.left="-50px",t.style.marginLeft="-47px"):this._itemCounter<1e3?(e.style.left="-55px",t.style.marginLeft="-52px"):this._itemCounter<1e4&&(e.style.left="-60px",t.style.marginLeft="-57px")}},_items:void 0,_itemCounter:0,_getItems:function(){if(void 0==this._items){for(var e=[],t=this._item.querySelectorAll("option"),i=0;i<t.length;i++){var n={id:t[i].value,index:i,text:t[i].innerHTML,selected:!!t[i].selected,selectElement:t[i]};e.push(n)}this._items=e}return this._items},_getItemUniqueIdentifier:function(){var e=this._item.getAttribute("id"),t=this._item.getAttribute("name");if(!e&&!t)throw"Multiselect: object does not contain any identifier (id or name)";return e?e:t},_getIdentifier:function(){return this._getItemUniqueIdentifier()+"_multiSelect"},_getInputFieldIdentifier:function(){return this._getItemUniqueIdentifier()+"_input"},_getItemListIdentifier:function(){return this._getItemUniqueIdentifier()+"_itemList"},_getInputBadgeIdentifier:function(){return this._getItemUniqueIdentifier()+"_inputCount"}},window.multiselects=[],"undefined"!=typeof $?($.fn.multiselect=function(){0!=this.length&&$(this).each(function(e,t){window.multiselects.push(new Multiselect($(t)))})},$(document).click(function(e){hideMultiselects(e)})):(document.multiselect=function(e){window.multiselects.push(new Multiselect(e))},window.onclick=function(e){hideMultiselects(e)});