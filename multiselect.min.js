function Multiselect(e){if("undefined"!=typeof $&&!$(e).is("select"))throw"Multiselect: passed object must be a select";if("undefined"==typeof $&&"SELECT"!=e.tagName)throw"Multiselect: passed object must be a select";"undefined"!=typeof $?this._item=e[0]:this._item=e,this._createUI(),this._appendEvents(),this._initSelectedFields()}function hideMultiselects(e){m_helper.each(window.multiselects,function(t){document.getElementById(t._getItemListIdentifier()).offsetParent&&!m_helper.parent(e.target,t._getIdentifier())&&t._hideList(t,e)})}if(!m_helper)var m_helper={removeNode:function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},insertAfter:function(e,t){var i=t.parentNode;t.nextElementSibling?i.insertBefore(e,t.nextElementSibling):i.appendChild(e)},hide:function(e){e.style.display="none"},hideAll:function(e){for(var t=0;t<e.length;t++)this.hide(e[t])},show:function(e){e.style.display="block"},showAll:function(e){for(var t=0;t<e.length;t++)this.show(e[t])},parent:function(e,t){for(var i=e.parentElement;i&&"BODY"!=i.tagName;){if(i.id==t)return i;i=i.parentElement}return null},create:function(e){var t=document.createElement(e.tag);if(e.id&&(t.id=e.id),e["class"]&&(t.className=e["class"]),e.attributes)for(var i in e.attributes)t.setAttribute(i,e.attributes[i]);if(e.data)for(var i in e.data)t.dataset[i]=e.data[i];return t},div:function(e){return e||(e=new Object),e.tag="div",this.create(e)},label:function(e){return e||(e=new Object),e.tag="label",this.create(e)},textField:function(e){return e||(e=new Object),e.tag="input",e.attributes||(e.attributes=new Object),e.attributes.type="text",this.create(e)},checkbox:function(e){return e||(e=new Object),e.tag="input",e.attributes||(e.attributes=new Object),e.attributes.type="checkbox",this.create(e)},each:function(e,t){for(var i=0;i<e.length;i++)t(e[i])},setActive:function(e){e.classList.add("active")},setUnactive:function(e){e.classList.remove("active")},select:function(e){e.setAttribute("selected","selected")},deselect:function(e){e.removeAttribute("selected")},check:function(e){e.checked=!0},uncheck:function(e){e.checked=!1}};Multiselect.prototype={_createUI:function(){m_helper.removeNode(this._getIdentifier());var e=this._createWrapper();m_helper.insertAfter(e,this._item),e.appendChild(this._createInputField()),e.appendChild(this._createItemList()),m_helper.hide(this._item)},_createWrapper:function(){var e=document.createElement("div");return e.className="multiselect-wrapper",e.id=this._getIdentifier(),e},_createInputField:function(){var e=m_helper.textField({id:this._getInputFieldIdentifier(),"class":"multiselect-input"}),t=m_helper.label({id:this._getInputBadgeIdentifier(),"class":"multiselect-count",attributes:{"for":this._getInputFieldIdentifier()}}),i=m_helper.label({"class":"multiselect-dropdown-arrow",attributes:{"for":this._getInputFieldIdentifier()}}),n=m_helper.div({"class":"multiselect-input-div"});return t.style.visibility="hidden",t.innerHTML=0,n.appendChild(e),n.appendChild(t),n.appendChild(i),n},_createItemList:function(){var e=m_helper.create({tag:"ul"}),t=this;m_helper.each(this._getItems(this._item),function(i){var n=t._createItem("li",i.id,i.text,i.selected);e.appendChild(n);var l=n.querySelector("input[type=checkbox]");i.multiselectElement=l,l.dataset.multiselectElement=JSON.stringify(i)});var i=this._createItem("span",-1,"Select all"),n=m_helper.div({id:this._getItemListIdentifier(),"class":"multiselect-list"});return n.appendChild(i),n.appendChild(m_helper.create({tag:"hr"})),n.appendChild(e),n},_createItem:function(e,t,i){var n=m_helper.checkbox({"class":"multiselect-checkbox",data:{val:t}}),l=m_helper.create({tag:"span","class":"multiselect-text"}),r=m_helper.create({tag:e}),c=m_helper.label();return l.className="multiselect-text",l.innerHTML=i,c.appendChild(n),c.appendChild(l),r.appendChild(c),r},_initSelectedFields:function(){var e=this._getItems().filter(function(e){return e.selected});if(0!=e.length){var t=this;m_helper.each(e,function(e){t.select(e.id)})}else this.selectAll()},select:function(e){var t=this;e&&m_helper.each(document.getElementById(this._getIdentifier()).querySelectorAll(".multiselect-checkbox"),function(i){i.dataset.val==e&&t._onCheckBoxChange(i,t)})},selectAll:function(){var e=document.querySelector("#"+this._getIdentifier()+" .multiselect-checkbox");m_helper.check(e),this._onCheckBoxChange(e,this),this._hideList(this)},_appendEvents:function(){var e=this;document.getElementById(e._getInputFieldIdentifier()).addEventListener("focus",function(t){e._showList(e),document.getElementById(e._getInputFieldIdentifier()).value="",m_helper.each(window.multiselects,function(i){document.getElementById(i._getItemListIdentifier()).offsetParent&&m_helper.parent(t.target,i._getIdentifier())&&i._hideList(e)})}),document.getElementById(e._getInputFieldIdentifier()).addEventListener("click",function(){e._showList(e),document.getElementById(e._getInputFieldIdentifier()).value=""}),document.getElementById(e._getIdentifier()).addEventListener("click",function(t){t=t||window.event;var i=t.target||t.srcElement;m_helper.parent(i,e._getIdentifier())&&t.stopPropagation()}),document.getElementById(e._getItemListIdentifier()).addEventListener("mouseover",function(){e._showList(e)}),m_helper.each(document.getElementById(e._getIdentifier()).querySelectorAll(".multiselect-checkbox"),function(t){t.addEventListener("change",function(i){e._onCheckBoxChange(t,e,i)})});var t=function(){var t=this.value.toLowerCase();if(t&&""!=t){m_helper.hide(document.querySelector("#"+e._getItemListIdentifier()+" > span")),m_helper.hide(document.querySelector("#"+e._getItemListIdentifier()+" > hr"));var i=Array.prototype.filter.call(document.querySelectorAll("#"+e._getItemListIdentifier()+" li span"),function(e){return e.innerHTML.toLowerCase().indexOf(t)>-1});m_helper.hideAll(document.querySelectorAll("#"+e._getItemListIdentifier()+" li")),m_helper.each(i,function(e){m_helper.show(e.parentElement.parentElement)})}else m_helper.show(document.querySelector("#"+e._getItemListIdentifier()+" > span")),m_helper.show(document.querySelector("#"+e._getItemListIdentifier()+" > hr")),m_helper.showAll(document.querySelectorAll("#"+e._getItemListIdentifier()+" li"))};document.getElementById(e._getInputFieldIdentifier()).addEventListener("propertychange",t),document.getElementById(e._getInputFieldIdentifier()).addEventListener("input",t)},_onCheckBoxChange:function(e,t){e.dataset.multiselectElement?(t._performSelectItem(e,t),t._updateSelectAll(t)):t._performSelectAll(e,t),t._forceUpdate()},_performSelectItem:function(e,t){var i=JSON.parse(e.dataset.multiselectElement);e.checked?(t._itemCounter++,m_helper.select(this._item.options[i.index]),m_helper.setActive(e.parentElement.parentElement)):(t._itemCounter--,m_helper.deselect(this._item.options[i.index]),m_helper.setUnactive(e.parentElement.parentElement))},_performSelectAll:function(e,t){var i=t._getItems();e.checked?(t._itemCounter=i.length,m_helper.each(i,function(e){m_helper.setActive(e.multiselectElement.parentElement.parentElement),m_helper.select(t._item.options[e.index]),m_helper.check(e.multiselectElement)})):(t._itemCounter=0,m_helper.each(i,function(e){e.multiselectElement.parentElement.parentElement.classList.remove("active"),t._item.options[e.index].removeAttribute("selected"),m_helper.uncheck(e.multiselectElement)}))},_updateSelectAll:function(e){var t=document.getElementById(e._getItemListIdentifier()).querySelector("input[type=checkbox]");e._itemCounter==e._getItems().length?t.checked=!0:t.checked&&(t.checked=!1)},_hideList:function(e,t){m_helper.setUnactive(document.getElementById(e._getItemListIdentifier())),m_helper.show(document.getElementById(e._getItemListIdentifier()).querySelector("span")),m_helper.show(document.getElementById(e._getItemListIdentifier()).querySelector("hr")),m_helper.showAll(document.getElementById(e._getItemListIdentifier()).querySelectorAll("li")),e._updateText(e),t&&t.stopPropagation()},_updateText:function(e){var t=document.getElementById(e._getItemListIdentifier()).querySelectorAll("ul .active");if(t.length>0){for(var i="",n=0;n<(t.length<5?t.length:5);n++)i+=t[n].innerText+", ";i=i.substr(0,i.length-2),i.length>20&&(i=i.substr(0,17)+"..."),t.length==document.getElementById(e._getItemListIdentifier()).querySelectorAll("ul li").length&&(i="All selected"),document.getElementById(e._getInputFieldIdentifier()).value=i}},_showList:function(e){m_helper.setActive(document.getElementById(e._getItemListIdentifier()))},_forceUpdate:function(){var e=document.getElementById(this._getInputBadgeIdentifier());if(e.style.visibility="hidden",0!=this._itemCounter){e.innerHTML=this._itemCounter,e.style.visibility="visible";var t=e.nextElementSibling;this._itemCounter<10?(e.style.left="-45px",t.style.marginLeft="-42px"):this._itemCounter<100?(e.style.left="-50px",t.style.marginLeft="-47px"):this._itemCounter<1e3?(e.style.left="-55px",t.style.marginLeft="-52px"):this._itemCounter<1e4&&(e.style.left="-60px",t.style.marginLeft="-57px")}},_items:void 0,_itemCounter:0,_getItems:function(){if(void 0==this._items){for(var e=[],t=this._item.options,i=0;i<t.length;i++){var n={id:t[i].value,index:i,text:t[i].innerHTML,selected:!!t[i].selected,selectElement:t[i]};e.push(n)}this._items=e}return this._items},_getItemUniqueIdentifier:function(){var e=this._item.getAttribute("id"),t=this._item.getAttribute("name");if(!e&&!t)throw"Multiselect: object does not contain any identifier (id or name)";return e?e:t},_getIdentifier:function(){return this._getItemUniqueIdentifier()+"_multiSelect"},_getInputFieldIdentifier:function(){return this._getItemUniqueIdentifier()+"_input"},_getItemListIdentifier:function(){return this._getItemUniqueIdentifier()+"_itemList"},_getInputBadgeIdentifier:function(){return this._getItemUniqueIdentifier()+"_inputCount"}},window.multiselects=[],"undefined"!=typeof $?($.fn.multiselect=function(){0!=this.length&&$(this).each(function(e,t){window.multiselects.push(new Multiselect($(t)))})},$(document).click(function(e){hideMultiselects(e)})):(document.multiselect=function(e){m_helper.each(document.querySelectorAll(e),function(e){window.multiselects.push(new Multiselect(e))})},window.onclick=function(e){hideMultiselects(e)});